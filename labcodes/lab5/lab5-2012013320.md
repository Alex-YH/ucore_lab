# Lab5 实验报告
# 杨皓 2012013320

## 练习1

1. 请在实验报告中简要说明你的设计实现过程。 
- 本次实验首先需要将之前几次代码更新，即将系统调用T_SYSCALL中断描述符进行初始化；将时钟中断中将当前进程的need_resched设置为1。 
- 之后再将子进程的trapframe中的字段初始化，并且将CS、DS、ES、SS寄存器分别设置为相应的段，ESP设置为用户栈顶，EIP设置为ELF文件的入口，EFLAGES设置为允许中断。

2. 当创建一个用户态进程并加载了应用程序之后，CPU是如何将这个应用程序最终在用户态执行起来的。
- 在load_icode（）中加载并设置了trapframe。之后在sys_exec执行完成之后iret返回用户态，同时将eip设置为trapframe保存的值并从那里开始执行，此时应用程序即已经在用户态执行起来。

3. 与参考答案的区别。
- 本练习涉及到的均为初始化操作，故与参考答案并没有什么特别大的区别。

## 练习2

1. 在实验报告中简要说明如何设计实现“Copy on Write”机制，给出概要设计，鼓励给出详细设计。
- 可以通过增加标记位的方式来实现该机制，设改位为flag。在copy_range的时候，不复制该页，而是将flag置1；当要写入该页时，若标记位为1，则进入中断处理程序，将该页写回。

## 练习3

1. 请分析fork/exec/wait/exit在实现中是如何影响进程的执行状态的。

- fork新建的进程状态为UNINIT，结束时变为PROC_RUNNABLE。
- exec时，proc的状态始终为RUNNING。
- wait时，若当前进程存在子进程，则进程状态变为PROC_SLEEPING。
- exit时，变为ZOMBIE。

2. 请给出ucore中一个用户态进程的执行状态生命周期图（包执行状态，执行状态之间的变换关系，以及产生变换的事件或函数调用）。（字符方式画即可）

```

                                                      PROC_ZOMBIE <-------------------------
                                                        ^                                  |
                                                        |                                  | 
                                                        |                                  |
                                                        |                                  |
                                                        | do_exit                          | do_exit
                                                        |                                  |
                                                        |                                  |
                                                        |                                  |
 do_fork/alloc_proc             do_fork/wakeup_proc     |                 do_wait          |
 ---------------> PROC_UNINIT ----------------------> PROC_RUNNABLE -----------------> PROC_SLEEPING
                                                                    <-----------------
                                                                          do_exit  

```

## 实验总结

- 本次试验重点在于用户进程的创建与执行，从内核态切换至用户态时各结构的设置以及实现。
- 本次试验对于进程队列的维护方面并没有过多的设计，希望在之后的学习中能够有进一步的了解。




